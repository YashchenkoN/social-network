<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ua.social.network.query.CommunityMapper">

    <sql id="coreAttributes">
      community.id AS id,
      community.name AS name,
      community.description AS description
    </sql>

    <select id="getSingle" resultMap="CommunityRM">
        SELECT
        <include refid="coreAttributes"/>,
        post.id AS postId,
        post.create_date AS postDate,
        post.text AS postText
        FROM community
        LEFT JOIN post_community_assoc ON post_community_assoc.community_id = community.id
        LEFT JOIN post ON post.id = post_community_assoc.post_id
        <where>
            community.id = #{id}
        </where>
    </select>

    <select id="getList" resultMap="CommunityRM">
        SELECT
        <include refid="coreAttributes"/>
        FROM community
    </select>

    <resultMap id="CommunityRM" type="Community">
        <id column="id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <collection property="posts" ofType="Post">
            <id column="postId"/>
            <result column="postDate" property="createdDate"/>
            <result column="postText" property="text"/>
        </collection>
    </resultMap>
</mapper>